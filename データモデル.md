# データモデル

## エンティティ概要
| エンティティ | 主な属性 | 関連 | 備考 |
| --- | --- | --- | --- |
| User | id, email, passwordHash, name, planType, timezone | Goal, DailyStartComment, Bonnou, Action, Reflection | プラン判定とタイムゾーンで日次の区切りを管理 |
| Goal | id, userId, title, description, status, updatedAt | User | 長期目標。最新状態のみ管理（履歴は拡張で対応） |
| DailyStartComment | id, userId, date, content, moodScore | User | 日付で一意。気分スコアは 0–9 または 1–10 |
| Bonnou | id, userId, title, description, tags[] | User, BonnouOccurrence | 再発する煩悩のマスタ。タグは文字列配列またはタグテーブル |
| BonnouOccurrence | id, userId, bonnouId, occurredAt, scoreBefore, scoreAfter, note | Bonnou, ActionLog | 発生ログ。scoreBefore は初期値、scoreAfter は最終値として保持し、複数アクションを通じた総変化を表す |
| Action | id, userId, name, description, category, isArchived | User, ActionLog | ユーザーが管理するアクションテンプレート |
| ActionLog | id, userId, bonnouOccurrenceId, actionId, executedAt, note, scoreDelta | Action, BonnouOccurrence | scoreDelta はアクション実施直前のスコアと実施直後のスコア差分（任意）。実測値は BonnouOccurrence 側の scoreBefore/scoreAfter と連動 |
| Reflection | id, userId, date, goodThings[3], gratitude[3], reevaluatedScore, note | User | デイリースタートコメントと同じ日付キー |
| AnalyticsSnapshot（任意） | id, userId, periodStart, periodEnd, metrics | User | 定期バッチで算出する集計（将来拡張） |

## 関係性（概要）
- User 1 ─ n Goal / DailyStartComment / Bonnou / Action / Reflection。
- Bonnou 1 ─ n BonnouOccurrence。
- BonnouOccurrence 1 ─ n ActionLog（1度の煩悩発生に複数アクションを紐付ける場合）。
- Action 1 ─ n ActionLog。
- DailyStartComment と Reflection は `date` によるユニーク制約を設け、同日重複を防止。
- BonnouOccurrence と Reflection の `date` を用いた結合により、日次振り返り時にスコア差分を集計。

## データ利用シナリオ
- 日次ダッシュボード: 当日の DailyStartComment、未入力の Reflection、最新の BonnouOccurrence を集約。
- 煩悩分析: BonnouOccurrence の scoreBefore/scoreAfter で総改善量を把握しつつ、ActionLog の scoreDelta 平均で個別アクションの寄与を把握。
- モバイル対応: API では日付範囲での取得（Pagination + Cursor）を提供し、レスポンスサイズを抑える。
- セキュリティ: User ごとのスコープでクエリを限定し、操作ログには userId, entityId, action, timestamp を記録する設計を推奨。
